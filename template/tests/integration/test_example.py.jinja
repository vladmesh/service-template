"""
Integration test example for {{ project_name }}.

This test demonstrates how to write integration tests for your services.
Integration tests verify that different components work together correctly.
"""

import pytest
from httpx import AsyncClient

{% if 'backend' in modules -%}
@pytest.mark.asyncio
async def test_backend_health_endpoint():
    """
    Test that the backend health endpoint returns 200 OK.
    
    This is a basic integration test that verifies:
    1. The backend service is running
    2. The health endpoint is accessible
    3. The response format is correct
    """
    async with AsyncClient(base_url="http://backend:8000") as client:
        response = await client.get("/health")
        assert response.status_code == 200
        data = response.json()
        assert "status" in data
        assert data["status"] == "healthy"


@pytest.mark.asyncio
async def test_backend_openapi_spec():
    """
    Test that the OpenAPI specification is available.
    
    This ensures that API documentation is properly generated
    and accessible at the standard endpoint.
    """
    async with AsyncClient(base_url="http://backend:8000") as client:
        response = await client.get("/openapi.json")
        assert response.status_code == 200
        spec = response.json()
        assert "openapi" in spec
        assert "info" in spec
        assert "paths" in spec

{% endif %}

# Add your integration tests here
# 
# Example patterns:
# 
# 1. Testing API endpoints:
#    @pytest.mark.asyncio
#    async def test_create_resource():
#        async with AsyncClient(base_url="http://backend:8000") as client:
#            response = await client.post("/api/resource", json={"name": "test"})
#            assert response.status_code == 201
#
# 2. Testing database operations:
#    @pytest.mark.asyncio
#    async def test_database_crud(db_session):
#        # Use fixtures from conftest.py
#        result = await db_session.execute(select(MyModel))
#        assert result.scalars().all() == []
#
# 3. Testing service interactions:
#    @pytest.mark.asyncio
#    async def test_service_communication():
#        # Test that services can communicate with each other
#        pass
