version: 2
services:
{% if 'backend' in modules %}
  - name: backend
    type: python-fastapi
    description: >
      FastAPI backend that exposes REST endpoints, owns the database, and powers the rest of the
      system.
    dev_template: true
{% endif %}
{% if 'tg_bot' in modules %}
  - name: tg_bot
    type: python-faststream
    description: >
      Telegram bot for user interaction and event publishing.
    dev_template: true
    depends_on:
{% if 'backend' in modules %}
      backend: service_started
{% endif %}
      redis: service_healthy
{% if 'backend' in modules %}
    profiles:
      - tg
{% endif %}
{% endif %}
{% if 'frontend' in modules %}
  - name: frontend
    type: node
    description: >
      Static frontend placeholder served separately via infra/compose.frontend.yml.
{% endif %}
{% if 'notifications' in modules %}
  - name: notifications_worker
    type: python-faststream
    description: >
      Service for notifications (email, telegram).
    dev_template: true
    depends_on:
      redis: service_healthy
{% endif %}
