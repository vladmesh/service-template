{#
Template for generating registry.py with auto-registration of routers.
Centralizes all router registration to eliminate manual boilerplate.
#}
# AUTO-GENERATED BY SERVICE-TEMPLATE - DO NOT EDIT
"""
Registry for {{ service_name }} service.

Provides auto-registration of all generated routers and event adapters.
"""
from __future__ import annotations

from collections.abc import Callable

from fastapi import APIRouter
from faststream.redis import RedisBroker
from sqlalchemy.ext.asyncio import AsyncSession

{% for domain in domains %}
from .routers.{{ domain.name }} import create_router as create_{{ domain.name }}_router
{% endfor %}
from .protocols import (
{% for protocol in protocol_imports %}
    {{ protocol }},
{% endfor %}
)
{% if has_event_adapter %}
from .event_adapter import create_event_adapter
{% endif %}


def create_api_router(
    get_db: Callable[[], AsyncSession],
    get_broker: Callable[[], RedisBroker],
{% for domain in domains %}
    get_{{ domain.name }}_controller: Callable[[], {{ domain.protocol_name }}],
{% endfor %}
) -> APIRouter:
    """Create and configure the API router with all domain routers.

    Args:
        get_db: Dependency to get DB session.
        get_broker: Dependency to get Redis broker for event publishing.
{% for domain in domains %}
        get_{{ domain.name }}_controller: Factory for {{ domain.name }} controller.
{% endfor %}

    Returns:
        Configured APIRouter with all domain routers included.
    """
    router = APIRouter()

{% for domain in domains %}
    router.include_router(
        create_{{ domain.name }}_router(
            get_db,
            get_{{ domain.name }}_controller,
            {% if domain.has_events %}
            get_broker,
            {% endif %}
        )
    )
{% endfor %}

    return router


# Re-export protocols for convenient imports
__all__ = [
    "create_api_router",
{% for protocol in protocol_imports %}
    "{{ protocol }}",
{% endfor %}
{% if has_event_adapter %}
    "create_event_adapter",
{% endif %}
]

