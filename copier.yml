_min_copier_version: "9.0.0"
_answers_file: .copier-answers.yml
_templates_suffix: .jinja

# Files to exclude from template (template development files)
_exclude:
  - .git
  - .git/**
  - __pycache__
  - "**/__pycache__"
  - "*.pyc"
  - .pytest_cache
  - "**/.pytest_cache"
  - .mypy_cache
  - "**/.mypy_cache"
  - .ruff_cache
  - "**/.ruff_cache"
  - .venv
  - "**/.venv"
  - node_modules
  - "**/node_modules"
  - .env
  - "*.egg-info"
  - dist
  - build
  - "**/*.egg-info"
  - .coverage
  - "**/.coverage"
  # Template-specific files (not needed in generated project)
  - copier.yml
  - docs/COPIER_MIGRATION_PLAN.md
  - tests/copier
  - tests/copier/**
  # Jinja source templates (rendered versions are copied instead)
  - Makefile.jinja
  - AGENTS.md.jinja
  - ARCHITECTURE.md.jinja
  - .env.example.jinja
  - services.yml.jinja
  - README.md.jinja
  - infra/compose.base.yml.jinja
  - infra/compose.dev.yml.jinja
  - "{{ _copier_conf.answers_file }}.jinja"

  # Always exclude test_service (it's for template development only)
  - services/test_service
  - services/test_service/**

# Files to skip if they already exist (preserve user modifications on update)
_skip_if_exists:
  - .env
  - .env.example
  - shared/spec/models.yaml
  - shared/spec/events.yaml
  - "services/*/src/app/**"
  - "services/*/src/controllers/**"

# ============================================================================
# Project Metadata
# ============================================================================

project_name:
  type: str
  help: "Project name (lowercase, hyphens allowed, e.g. 'my-awesome-api')"
  validator: "{% if not project_name | regex_search('^[a-z][a-z0-9-]*$') %}Project name must be lowercase, start with a letter, and contain only letters, numbers, and hyphens{% endif %}"

project_slug:
  type: str
  default: "{{ project_name | replace('-', '_') }}"
  when: false  # Computed, not asked

project_description:
  type: str
  help: "Short project description"
  default: "A microservice project built with service-template framework"

author_name:
  type: str
  help: "Author name"
  default: "Developer"

author_email:
  type: str
  help: "Author email"
  default: "dev@example.com"

# ============================================================================
# Module Selection
# ============================================================================

modules:
  type: str
  help: |
    Modules to include (comma-separated).
    Available: backend, tg_bot, notifications, frontend
    Example: backend,tg_bot
  default: "backend"

# Computed list for easier iteration
modules_list:
  type: str
  default: "{{ modules.split(',') | map('trim') | list }}"
  when: false

# ============================================================================
# Technical Options
# ============================================================================

python_version:
  type: str
  help: "Python version"
  default: "3.12"
  choices:
    - "3.11"
    - "3.12"

node_version:
  type: str
  help: "Node.js version (for frontend)"
  default: "20"
  when: "{{ 'frontend' in modules }}"

# ============================================================================
# Tasks - Clean up unselected modules after copy
# ============================================================================
_tasks:
  - "{% if 'tg_bot' not in modules %}rm -rf services/tg_bot{% endif %}"
  - "{% if 'notifications' not in modules %}rm -rf services/notifications_worker{% endif %}"
  - "{% if 'frontend' not in modules %}rm -rf services/frontend{% endif %}"
