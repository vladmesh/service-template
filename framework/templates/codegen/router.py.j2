# AUTO-GENERATED BY SERVICE-TEMPLATE - DO NOT EDIT
"""
Router for {{ module_name }}.
"""
# AUTO-GENERATED FROM shared/spec/rest.yaml â€“ DO NOT EDIT MANUALLY

from __future__ import annotations

from collections.abc import Callable

from fastapi import APIRouter, Body, Depends, Path, Query  # noqa: F401
from sqlalchemy.ext.asyncio import AsyncSession

{% if imports %}
from shared.generated.schemas import (
    {% for model in imports|sort %}
    {{ model }},
    {% endfor %}
)
{% endif %}
from ..protocols import {{ protocol_name }}


def create_router(
    get_db: Callable[[], AsyncSession],
    get_controller: Callable[[], {{ protocol_name }}],
) -> APIRouter:
    """
    Create and configure the {{ module_name }} router.

    Args:
        get_db: Dependency to get DB session
        get_controller: Dependency to get controller implementation

    Returns:
        Configured APIRouter instance
    """
    router = APIRouter(
        {% if prefix %}
        prefix="{{ prefix }}",
        {% endif %}
        {% if tags %}
        tags={{ tags }},
        {% endif %}
    )

    {% for handler in handlers %}
    @router.{{ handler.method|lower }}(
        "{{ handler.path }}",
        {% if handler.response_model %}
        response_model={{ handler.response_model }},
        {% endif %}
        status_code={{ handler.status_code }},
        {% if handler.tags %}
        tags={{ handler.tags }},
        {% endif %}
    )
    {% if async_handlers %}
    async def {{ handler.name }}(
    {% else %}
    def {{ handler.name }}(
    {% endif %}
        {% for param in handler.params %}
        {{ param.name }}: {{ param.type }} = {{ param.source }},
        {% endfor %}
        {% if handler.request_model %}
        payload: {{ handler.request_model }} = Body(...),  # noqa: B008
        {% endif %}
        session: AsyncSession = Depends(get_db),  # noqa: B008
        controller: {{ protocol_name }} = Depends(get_controller),  # noqa: B008
    ) -> {{ handler.return_type }}:
        """{{ handler.docstring }}"""
        return await controller.{{ handler.name }}(
            session=session,
            {% for param in handler.params %}
            {{ param.name }}={{ param.name }},
            {% endfor %}
            {% if handler.request_model %}
            payload=payload,
            {% endif %}
        )

    {% endfor %}
    return router
