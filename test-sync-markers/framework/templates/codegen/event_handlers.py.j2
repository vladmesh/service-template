{#
Template for generating event handler registration with Protocol pattern.
Generates the FastStream subscriber registration that delegates to handler protocol.
#}
# Generated by framework - DO NOT EDIT
from collections.abc import Callable
from typing import Protocol

{% if imports %}
from shared.generated.events import broker
from shared.generated.schemas import {{ imports | join(", ") }}
{% endif %}


class EventsHandlerProtocol(Protocol):
    """Protocol for event handlers.
    
    Implement this in your service to handle subscribed events.
    """
{% for handler in handlers %}

    async def {{ handler.name }}(self, event: {{ handler.message_model }}) -> None:
        """Handle {{ handler.subject }} event."""
        ...
{% endfor %}


def register_event_handlers(
    get_handler: Callable[[], EventsHandlerProtocol],
) -> None:
    """Register event handlers with the broker.
    
    Args:
        get_handler: Factory function that returns the handler instance.
                     Called for each event to allow DI of dependencies.
    """
{% for handler in handlers %}
    @broker.subscriber("{{ handler.subject }}")
    async def _handle_{{ handler.name }}(event: {{ handler.message_model }}) -> None:
        handler = get_handler()
        await handler.{{ handler.name }}(event)

{% endfor %}
