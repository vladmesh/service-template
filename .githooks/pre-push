#!/usr/bin/env bash
# Pre-push hook for service-template FRAMEWORK repository
# This hook verifies framework code quality before pushing
set -euo pipefail

remote_name="${1-}"
remote_url="${2-}"

REPO_ROOT="$(git rev-parse --show-toplevel)"
cd "${REPO_ROOT}"

echo "[pre-push] Verifying push to ${remote_name:-unknown} (${remote_url:-})..."

export DOCKER_BUILDKIT=1

# Check framework sync status
echo "[pre-push] Checking framework synchronization..."
make check-sync

# Run linters on framework code
echo "[pre-push] Running linters..."
make lint

# Run framework unit tests
echo "[pre-push] Running framework tests..."
make test

# Run copier template tests
echo "[pre-push] Running copier tests..."
make test-copier

echo "[pre-push] âœ… All checks passed!"
