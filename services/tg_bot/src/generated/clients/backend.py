##############################################################################
# THIS FILE IS GENERATED BY THE FRAMEWORK. DO NOT EDIT MANUALLY.
# CHANGES WILL BE OVERWRITTEN.
##############################################################################

# AUTO-GENERATED BY SERVICE-TEMPLATE - DO NOT EDIT
"""
Typed HTTP client for backend service.
"""

from __future__ import annotations

import os
from typing import Any

import httpx
from shared.generated.schemas import (
    UserCreate,
    UserRead,
)


class BackendClient:
    """Async HTTP client for backend service API.

    Usage:
        async with BackendClient() as client:
            result = await client.create_user(payload)
    """

    def __init__(
        self,
        base_url: str | None = None,
        timeout: float = 10.0,
    ) -> None:
        """Initialize client.

        Args:
            base_url: Base URL for the service. Defaults to BACKEND_API_URL env var.
            timeout: Request timeout in seconds.
        """
        self.base_url = base_url or os.getenv("BACKEND_API_URL", "")
        if not self.base_url:
            raise ValueError(
                "BackendClient requires base_url or BACKEND_API_URL environment variable"
            )
        self.timeout = timeout
        self._client: httpx.AsyncClient | None = None

    async def __aenter__(self) -> BackendClient:
        """Enter async context manager."""
        self._client = httpx.AsyncClient(
            base_url=self.base_url,
            timeout=self.timeout,
        )
        return self

    async def __aexit__(self, *args: Any) -> None:
        """Exit async context manager."""
        if self._client:
            await self._client.aclose()
            self._client = None

    def _ensure_client(self) -> httpx.AsyncClient:
        """Ensure client is initialized."""
        if self._client is None:
            raise RuntimeError(
                "BackendClient must be used as async context manager: "
                "async with BackendClient() as client: ..."
            )
        return self._client

    # --- users operations ---

    async def create_user(
        self,
        payload: UserCreate,
    ) -> UserRead:
        """Call create_user on backend service."""
        client = self._ensure_client()

        path = "/users"

        response = await client.post(
            path,
            json=payload.model_dump(mode="json"),
        )
        response.raise_for_status()
        return UserRead.model_validate(response.json())

    async def get_user(
        self,
        user_id: int,
    ) -> UserRead:
        """Call get_user on backend service."""
        client = self._ensure_client()

        path = f"/users/{user_id}"

        response = await client.get(
            path,
        )
        response.raise_for_status()
        return UserRead.model_validate(response.json())
